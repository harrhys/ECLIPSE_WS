<project default="all">

	<property name="wls.host" value="churchill" />
	<property name="wls.port" value="7001" />
	<property name="wls.user" value="defAdmin" />
	<property name="wls.pass" value="defPwd00" />
	<property name="wls.server" value="AdminServer" />

	<property name="ear.deployed.name" value="JSca_Ref_WS" />
	<property name="output.dir" value="output" />
	<property name="ear.dir" value="${output.dir}/JSca_WS_Ref_EAR" />
	<property name="src.dir" value="java_src" />
	<property name="clientclass.dir" value="${src.dir}" />

	<path id="client.class.path">
		<pathelement path="${src.dir}" />
		<pathelement path="${java.class.path}" />
	</path>

	<path id="server.class.path">
		<pathelement path="${src.dir}" />
		<pathelement path="${java.class.path}" />
	</path>

	<taskdef name="jwsc" classname="weblogic.wsee.tools.anttasks.JwscTask" />
	<taskdef name="clientgen" classname="weblogic.wsee.tools.anttasks.ClientGenTask" />
	<taskdef name="wldeploy" classname="weblogic.ant.taskdefs.management.WLDeploy" />

	<target name="all" depends="clean,build-service,deploy" />

	<target name="clean">
		<delete dir="${output.dir}" />
	</target>

	<target name="init">
		<mkdir dir="${ear.dir}/APP-INF/classes" />
	</target>

	<target name="build-service">

		<jwsc srcdir="${src.dir}" destdir="${ear.dir}" keepGenerated="true">
			<jws file="com/oracle/enterprisetest/jsca/getqty/ws/GetTotalQuantity.java" contextPath="GetQuantityRef_WS_CTX"
				generateWsdl="true" explode="true" type="JAXWS">
			       <WLHttpTransport
			          contextPath="GetQuantityRef_WS_CTX" serviceUri="GetQuantityRef_WS_URI"
			          portName="GetQuantityRef_WS_Port"/>
			</jws>
		</jwsc>

		<jwsc srcdir="${src.dir}" destdir="${ear.dir}" keepGenerated="true">
			<jws file="com/oracle/enterprisetest/jsca/getprc/ws/GetTotalPrice.java" contextPath="GetPriceRef_WS_CTX"
				generateWsdl="true" explode="true" type="JAXWS">
			       <WLHttpTransport
			          contextPath="GetPriceRef_WS_CTX" serviceUri="GetPriceRef_WS_URI"
			          portName="GetPriceRef_WS_Port"/>
			</jws>
		</jwsc>

		<javac destdir="${ear.dir}/APP-INF/classes" failonerror="true">
			<src path="${src.dir}" />
			<include name="com/oracle/enterprisetest/jsca/cart/**" />
			<classpath refid="server.class.path" />
		</javac>

	</target>

	<target name="deploy">
		<wldeploy action="deploy" verbose="true" debug="true" name="${ear.deployed.name}" source="${ear.dir}" user="${wls.user}" password="${wls.pass}" adminurl="t3://${wls.host}:${wls.port}" targets="${wls.server}" />
	</target>

	<target name="redeploy">
		<wldeploy action="redeploy" verbose="true" debug="true" name="${ear.deployed.name}" source="${ear.dir}" user="${wls.user}" password="${wls.pass}" adminurl="t3://${wls.host}:${wls.port}" targets="${wls.server}" />
	</target>

	<target name="undeploy">
		<wldeploy action="undeploy" verbose="true" debug="true" name="${ear.deployed.name}" user="${wls.user}" password="${wls.pass}" adminurl="t3://${wls.host}:${wls.port}" targets="${wls.server}" />
	</target>

	<target name="clean-client">
		<delete>
			<fileset dir="${src.dir}/test/client" excludes="**/Main.java" />
		</delete>
	</target>
	<target name="build-client">
		<!--
		<clientgen wsdl="http://${wls.hostname}:${wls.port}/HelloWorldService/HelloWorldServiceService?WSDL" destDir="java_src" packageName="test.client" type="JAXWS" />
		<clientgen wsdl="http://${wls.hostname}:${wls.port}/HelloWorldClientService/HelloWorldClientServiceService?WSDL" destDir="java_src" packageName="test.client" type="JAXWS" />
		-->
		<clientgen wsdl="http://${wls.host}:${wls.port}/GetPriceRef_WS_CTX/GetPriceRef_WS_URI?WSDL" destDir="${src.dir}" packageName="test.client" type="JAXWS" />
		<clientgen wsdl="http://${wls.host}:${wls.port}/GetQuantityRef_WS_CTX/GetQuantityRef_WS_URI?WSDL" destDir="${src.dir}" packageName="test.client" type="JAXWS" />
	</target>


	<target name="run">
		<java fork="true" classname="test.client.Main" failonerror="true">
			<classpath refid="client.class.path" />
		</java>
	</target>

</project>