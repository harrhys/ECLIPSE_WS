<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE project [ <!ENTITY include SYSTEM "../../../common.xml"> ]>

  <!-- ======================================================= -->
  <!--  SunOne Application Server pkgingB Sample Application build xml -->
  <!-- ======================================================= -->

  <project name="pkgingB-sample" default="core" basedir=".">

  <property name="sample.home" value="../../../"/>
  <!-- ======================================================= -->
  <!--			 App name-dependent settings.	       -->
  <!-- ======================================================= -->

  <property name="appname" value="pkgingBApp"/>

  <!-- ======================================================= -->
  <!--	 Package directory structures of interest.     	       -->
  <!-- ======================================================= -->

  <property name="app.pkg" value="samples/packaging/pkgingB"/>
  <property name="jar.pkg" value="samples/packaging/pkging/ejb"/>
  <property name="war.pkg" value="samples/packaging/pkgingB/servlet"/>

  <property name="classpath.prefix" value="./verif.jar"/>
  <property name="components.pkgprefix" value="samples/packaging/pkging"/>
  <property name="build.components" value="../../components/build/classes"/>
  <property name="classpath.suffix" value="../../components/build/classes"/>
 
  <!-- ======================================================= -->
  <!--			Java Doc properties .					       -->
  <!-- ======================================================= -->
  
  <property name="sample.name" value="pkgingB"/>
  <property name="javadoc.pkgnames" value="samples.packaging.pkgingB.*" />

  <!-- ======================================================= -->
  <!--			Xml files properties .					       -->
  <!-- ======================================================= -->
  
  <!-- ======================================================= -->
  <!--				Include common.xml					       -->
  <!-- ======================================================= -->
 
  &include;

  <property name="war1" value="${appname}WAR1.war"/>
  <property name="war2" value="${appname}WAR2.war"/>
  <property name="ejbjar1" value="${appname}EJB1.jar"/>
  <property name="ejbjar2" value="${appname}EJB2.jar"/>

  <property name="assemble.ejbjar1" value="${assemble}/jar1"/>
  <property name="assemble.ejbjar2" value="${assemble}/jar2"/>
  <property name="assemble.war1" value="${assemble}/war1"/>
  <property name="assemble.war2" value="${assemble}/war2"/>

  <target name="componentsclean">
      <ant antfile="../../components/src/build.xml" dir="../../components/src" target="clean" />
  </target>

  <target name="componentscompile" depends="componentsclean">
      <ant antfile="../../components/src/build.xml" dir="../../components/src" target="compile" />
  </target>

  <target name="componentsjavadocs">
      <ant antfile="../../components/src/build.xml" dir="../../components/src" target="javadocs" inheritAll="false"/>
  </target>


  <!-- ======================================================= -->
  <!-- Assemble EJB JAR modules 1 and 2                        -->
  <!-- ======================================================= -->
  <target name="ejbjar_local" depends="clean_ejbjar,ejbjar1,ejbjar2" />

  <!-- ======================================================= -->
  <!-- Clean EJB JAR modules.                                  -->
  <!-- ======================================================= --> 
  <target name="clean_ejbjar">
    <delete dir="${assemble.ejbjar1}"/>
    <delete file="../${ejbjar1}"/>
    <delete dir="${assemble.ejbjar2}"/>
    <delete file="../${ejbjar2}"/>
  </target>

  <!-- ======================================================= -->
  <!-- Assemble EJB JAR module 1.                                -->
  <!-- ======================================================= -->
  <target name="ejbjar1" >
    <mkdir dir="${assemble.ejbjar1}"/>
    <copy todir="${assemble.ejbjar1}/${components.pkgprefix}">
        <fileset dir="${build.components}/${components.pkgprefix}/">
                <include name="**/*.class" />
                <exclude name="**/servlet/" />
                <exclude name="**/ejb/*Compound*.class" />
                <exclude name="**/lib/Date*.class" />
                <exclude name="**/ejb/*Module*.class"/>
        </fileset>
    </copy>
    <mkdir dir="${assemble.ejbjar1}/META-INF"/>
    <copy file="ejb1/ejb-jar.xml"     tofile="${assemble.ejbjar1}/META-INF/ejb-jar.xml"/>
    <copy file="ejb1/sun-ejb-jar.xml" tofile="${assemble.ejbjar1}/META-INF/sun-ejb-jar.xml"/>
    <jar jarfile="${assemble.ejbjar1}/${ejbjar1}"
       basedir="${assemble.ejbjar1}" excludes="**/*.jar" />
  </target>

 <!-- ======================================================= -->
  <!-- Assemble EJB JAR module 2.                                -->
  <!-- ======================================================= -->
  <target name="ejbjar2" >
    <mkdir dir="${assemble.ejbjar2}"/>
    <copy todir="${assemble.ejbjar2}/${components.pkgprefix}">
        <fileset dir="${build.components}/${components.pkgprefix}/">
                <include name="**/*.class" />
                <exclude name="**/servlet/" />
                <exclude name="**/ejb/*Simple*.class" />
                <exclude name="**/ejb/*Module*.class"/>
                <exclude name="**/lib/" />
        </fileset>
    </copy>
    <mkdir dir="${assemble.ejbjar2}/META-INF"/>
    <copy file="ejb2/ejb-jar.xml"     tofile="${assemble.ejbjar2}/META-INF/ejb-jar.xml"/>
    <copy file="ejb2/sun-ejb-jar.xml" tofile="${assemble.ejbjar2}/META-INF/sun-ejb-jar.xml"/>
    <jar jarfile="${assemble.ejbjar2}/${ejbjar2}"
       basedir="${assemble.ejbjar2}" excludes="**/*.jar" />
  </target>

  <!-- ======================================================= -->
  <!-- Assemble WAR modules 1 and 2.                                    -->
  <!-- ======================================================= -->
  <target name="war_local" depends="clean_war,war1,war2" />

  <!-- ======================================================= -->
  <!-- Clean WAR modules.                                      -->
  <!-- ======================================================= -->
  <target name="clean_war">
    <delete dir="${assemble.war1}"/>
    <delete file="../${war1}"/>
    <delete dir="${assemble.war2}"/>
    <delete file="../${war2}"/>
  </target>

  <!-- ======================================================= -->
  <!-- Assemble WAR module 1.                                    -->
  <!-- ======================================================= -->
  <target name="war1" >
    <mkdir dir="${assemble.war1}"/>
    <copy todir="${assemble.war1}">
        <fileset dir="${src.docroot}" >
                <exclude name="Compound*.jsp" />
                <exclude name="cvs,annontation" />
        </fileset>
    </copy>

    <copy todir="${assemble.war1}/WEB-INF/classes/${app.pkg}">
        <fileset dir="${build.classesdir}/${app.pkg}/">
                <include name="**/servlet/*.class"/>
                <exclude name="**/servlet/Compound*.class" />
        </fileset>
    </copy>
    <copy todir="${assemble.war1}/WEB-INF/classes/${components.pkgprefix}">
        <fileset dir="${build.components}/${components.pkgprefix}/">
                <include name="**/lib/DateLibrary.class"/>
        </fileset>
    </copy>

    <copy file="war1/web.xml"     tofile="${assemble.war1}/WEB-INF/web.xml"/>
    <copy file="war1/sun-web.xml" tofile="${assemble.war1}/WEB-INF/sun-web.xml"/>
    <jar jarfile="${assemble.war1}/${war1}"
       basedir="${assemble.war1}" excludes="**/*.war" />
  </target>


  <!-- ======================================================= -->
  <!-- Assemble WAR module 2.                                    -->
  <!-- ======================================================= -->
  <target name="war2" >
    <mkdir dir="${assemble.war2}"/>
    <copy todir="${assemble.war2}">
        <fileset dir="${src.docroot}" >
                <exclude name="Simple*.jsp" />
                <exclude name="index.html" />
                <exclude name="cvs,annontation" />
        </fileset>
    </copy>
    <copy todir="${assemble.war2}/WEB-INF/classes/${app.pkg}">
        <fileset dir="${build.classesdir}/${app.pkg}/">
                <include name="**/servlet/*.class"/>
                <exclude name="**/servlet/Simple*" />
        </fileset>
    </copy>
    <copy todir="${assemble.war2}/WEB-INF/classes/${components.pkgprefix}">
        <fileset dir="${build.components}/${components.pkgprefix}/">
                <include name="**/lib/DateLibrary.class"/>
        </fileset>
    </copy>

    <copy file="war2/web.xml"     tofile="${assemble.war2}/WEB-INF/web.xml"/>
    <copy file="war2/sun-web.xml" tofile="${assemble.war2}/WEB-INF/sun-web.xml"/>
    <jar jarfile="${assemble.war2}/${war2}"
       basedir="${assemble.war2}" excludes="**/*.war" />
  </target>


  <!-- ======================================================= -->
  <!-- Assemble EAR module.                                    -->
  <!-- ======================================================= -->
  <target name="ear_local" depends="clean_ear_common" >
    <mkdir dir="${assemble.ear}"/>
    <copy file="${assemble.ejbjar1}/${ejbjar1}" tofile="${assemble.ear}/${ejbjar1}"/>
    <copy file="${assemble.ejbjar2}/${ejbjar2}" tofile="${assemble.ear}/${ejbjar2}"/>
    <copy file="${assemble.war1}/${war1}"    tofile="${assemble.ear}/${war1}"/>
    <copy file="${assemble.war2}/${war2}"    tofile="${assemble.ear}/${war2}"/>
    <copy file="application.xml" tofile="${assemble.ear}/META-INF/application.xml"/>
    <jar jarfile="${assemble.ear}/${ear}"
       basedir="${assemble.ear}" excludes="**/*.ear"/>
    <delete file="${assemble.ear}/${ejbjar1}" />
    <delete file="${assemble.ear}/${ejbjar2}" />
    <delete file="${assemble.ear}/${war1}" />
    <delete file="${assemble.ear}/${war2}" />
    <copy file="${assemble.ear}/${ear}" tofile="../${ear}"/>
  </target>


  <!-- ======================================================= -->
  <!--		Tagets to build and deploy sample application      -->
  <!-- ======================================================= -->
  <target name="clean" depends="componentsclean,clean_common"/>
  <target name="init" depends="init_common"/>
  <target name="compile" depends="componentscompile,compile_common"/>
  <target name="javadocs" depends="componentsjavadocs, javadocs_common"/>
  <target name="war" depends="init,war_local"/>
  <target name="jar" depends="init,ejbjar_local"/>
  <target name="ear" depends="init,jar,war,ear_local"/>
  <target name="core" depends="componentscompile,compile,ear"/>
  <target name="deploy" depends="deploy_common"/>
  <target name="undeploy" depends="undeploy_common"/>
  <target name="verify" depends="verify_common"/>
  <target name="all" depends="core,componentsjavadocs,javadocs,verify,deploy"/>
</project>
