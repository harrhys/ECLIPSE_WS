<?xml version="1.0"?>

<!DOCTYPE project [ <!ENTITY include SYSTEM "../../../../common.xml"> ]>

  <!-- ============================================================== -->
  <!-- Sun ONE Application Server Sample Application build xml        -->
  <!--                                                                -->
  <!-- Copyright (c) 2001 Sun Microsystems, Inc. All rights reserved. -->
  <!-- ============================================================== -->

  <project name="product-sample" default="core" basedir=".">

  <!-- ============================================================== -->
  <!--           App name-dependent settings.                         -->
  <!-- ============================================================== -->

  <property name="appname"        value="cmp-simple"/>
  <property name="sample.home"    value="../../../../"/>
  <property name="sample.name"    value="ProductApp"/>

  <!-- ============================================================== -->
  <!--           App specific DD settings.                            -->
  <!-- ============================================================== -->

  <property name="jarDD" value="ejb-jar.xml,sun-ejb-jar.xml,
                           sun-cmp-mappings.xml"/>


  <!-- ============================================================== -->
  <!--           Package directory structures of interest.            -->
  <!-- ============================================================== -->

  <property name="app.pkg"        value="samples/ejb/cmp/simple/client"/>
  <property name="war.pkg"        value="samples/ejb/cmp/simple/servlet"/>
  <property name="jar.pkg"        value="samples/ejb/cmp/simple/ejb"/>

  <!-- ============================================================== -->
  <!--           Java Doc properties.                                 -->
  <!-- ============================================================== -->
  <property name="sample.name"      value="converter"/>
  <property name="javadoc.pkgnames" value="samples.ejb.cmp.simple.*" />

  <!-- ============================================================== -->
  <!--           Include common.xml.                                  -->
  <!-- ============================================================== -->

  &include;
  
  <!-- ============================================================== -->
  <!--           Resource specific properties.                        -->
  <!-- ============================================================== -->
  <property name="conpool.name"       value="cmp-simple-pool" />
  <property name="jdbc.resource.name" value="jdbc/cmp-simple" />
  <property name="pm.resource.name"   value="jdo/cmp-simple" />
  <property name="pm.factory.class"   
            value="com.sun.jdo.spi.persistence.support.sqlstore.impl.PersistenceManagerFactoryImpl" />

  <property name="db.user"  value="cmp"/>
  <property name="db.pwd"   value="cmp"/>
  <property name="ds.class" value="com.pointbase.jdbc.jdbcDataSource" />
  <property name="db.file"  value="sql/product.sql"/>
  <property name="url.prop" value="DatabaseName" />

  <!-- ============================================================== -->
  <!--           Tagets to build and deploy sample application.       -->
  <!-- ============================================================== -->
  <target name="create-jdbc-connection-pool">
    <property name="db.host"  value="localhost"/>
    <property name="db.port"  value="9092"/>
    <property name="db.sid"   value="sun-appserv-samples"/>
    <property name="db.url"   value="jdbc:pointbase://${db.host}:${db.port}\/${db.sid}" />
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="create-jdbc-connection-pool ${conpool.name}
          --datasourceclassname ${ds.class}
          --instance ${sunone.instance}" />
    </antcall>
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="set ${sunone.instance}.jdbc-connection-pool.${conpool.name}.property.${url.prop}=${db.url}" />
    </antcall>
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="set ${sunone.instance}.jdbc-connection-pool.${conpool.name}.property.User=${db.user}" />
    </antcall>
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="set ${sunone.instance}.jdbc-connection-pool.${conpool.name}.property.Password=${db.pwd}" />
    </antcall>
  </target>

  <target name="create-jdbc-resource">
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="create-jdbc-resource ${jdbc.resource.name} 
         --connectionpoolid ${conpool.name}
         --instance ${sunone.instance}" />
    </antcall>
  </target>

  <target name="create-persistence-resource">
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="create-persistence-resource ${pm.resource.name}
          --instance ${sunone.instance}" />
    </antcall>
    <antcall target="admin_command_common">
      <param name="admin.command" value="set 
        ${sunone.instance}.persistence-manager-factory-resource.${pm.resource.name}.factoryClass=${pm.factory.class}"/>
    </antcall>
    <antcall target="admin_command_common">
      <param name="admin.command" value="set 
        ${sunone.instance}.persistence-manager-factory-resource.${pm.resource.name}.JdbcResourceJndiName=${jdbc.resource.name}" />
    </antcall>
  </target>

  <target name="delete-jdbc-connection-pool">
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="delete-jdbc-connection-pool ${conpool.name} 
          --instance ${sunone.instance}" />
    </antcall>
  </target>

  <target name="delete-jdbc-resource">
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="delete-jdbc-resource ${jdbc.resource.name}
          --instance ${sunone.instance}" />
    </antcall>
  </target>

  <target name="delete-persistence-resource">
    <antcall target="admin_command_common">
      <param name="admin.command" 
        value="delete-persistence-resource ${pm.resource.name}
          --instance ${sunone.instance}" />
    </antcall>
  </target>

  <target name="setup" depends="setup_env">
    <antcall target="create-jdbc-connection-pool"/>
    <antcall target="create-jdbc-resource"/>
    <antcall target="create-persistence-resource"/>
    <antcall target="reconfig"/>
  </target>

  <target name="setup-ora" depends="setup_env">
    <property name="db.host"  value="localhost"/>
    <property name="db.port"  value="1521"/>
    <property name="db.sid"   value="sun-appserv-samples"/>
    <antcall target="create-jdbc-connection-pool">
      <param name="ds.class" value="oracle.jdbc.pool.OracleDataSource" />
      <param name="db.url"   value="jdbc:oracle:thin:@${db.host}:${db.port}:${db.sid}" />
      <param name="url.prop" value="url" />
    </antcall>
    <antcall target="create-jdbc-resource"/>
    <antcall target="create-persistence-resource"/>
    <antcall target="reconfig"/>
  </target>

  <target name="unsetup" depends="delete-persistence-resource,
    delete-jdbc-resource, delete-jdbc-connection-pool, reconfig"/>

  <target name="sql"        depends="sql_common"/>

  <target name="reconfig"   depends="reconfig_common"/>
  <target name="clean"      depends="clean_common"/>
  <target name="init"       depends="init_common"/>
  <target name="compile"    depends="compile_common" />
  <target name="javadocs"   depends="javadocs_common" />
  <target name="deploy"     depends="setup, deploy_common" />
  <target name="deploy-ora" depends="setup-ora, deploy_common" />
  <target name="undeploy"   depends="unsetup, undeploy_common"/>
  <target name="verify"     depends="verify_common"/>
  <target name="jar"        depends="create_ejbjar_common">
    <delete file="../${ejbjar}" />
    <delete file="${assemble.ejbjar}/${ejbjar}" />
    <copy file="sql/productSchema.dbschema" todir="${assemble.ejbjar}"/>
    <jar jarfile="../${ejbjar}"
       basedir="${assemble.ejbjar}"/>
    <copy file="../${ejbjar}" todir="${assemble.ejbjar}"/>
  </target>
  <target name="clientjar" depends="clientjar_common"/>
  <target name="war"       depends="create_war_common"/>
  <target name="ear"       depends="jar,war,clientjar,create_ear_common"/>
  <target name="core"      depends="compile,ear" />
  <target name="all"       depends="core,javadocs,verify,deploy"/>

</project>
