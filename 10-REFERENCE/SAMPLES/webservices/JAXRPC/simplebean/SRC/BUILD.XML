<?xml version="1.0"?>

<!DOCTYPE project [ <!ENTITY include SYSTEM "../../../../common.xml"> ]>

  <!-- ============================================================== -->
  <!-- Sun One Application Server Sample Application build xml        -->
  <!--                                                                -->
  <!-- Copyright (c) 2001 Sun Microsystems, Inc. All rights reserved. -->
  <!-- ============================================================== -->


<project name="JAX-RPC Tutorial" default="core" basedir=".">

  <!-- ============================================================== -->
  <!--           App name-dependent settings.                         -->
  <!-- ============================================================== -->

  <property name="appname"       value="jaxrpc-simplebean"/>
  <property name="apptype"       value="web"/>
  <property name="sample.home"   value="../../../../"/>
  <property name="javadoc.pkgnames" value="samples.webservices.jaxrpc.simplebean.*" />
  <property name="deploy.file"   value="../${appname}.war"/>
  <property name="verify.file"   value="../${appname}.war"/>
  <property name="client.class"  value="samples.webservices.jaxrpc.simplebean.HelloClient"/>
  <property name="portable-war"  value="${appname}-portable.war"/>
  
  &include; 

  <property name="classpath.suffix" value="${com.sun.aas.javaRoot}/lib/tools.jar" />

  <target name="wscompile-client" depends="compile-server"
      description="Runs the wscompile tool for the client.">
      <echo message="Running wscompile for the client:"/>
      <mkdir dir="${build}/client/" />
      <java classname="com.sun.xml.rpc.tools.wscompile.Main" fork="yes" dir=".">
      <classpath path="${build.classpath}"/>
         <arg line="-gen:client" />
         <arg line="-d ${build}/client" />
         <arg line="-classpath ${build}/shared" />
         <arg line="config.xml" />
      </java>
  </target>

  <target name="compile-server" depends="init"
      description="Compiles the server-side source code">
      <echo message="Compiling the server-side source code...."/>
      <mkdir dir="${build}/shared/" />
      <javac
         srcdir="."
         destdir="${build}/shared"
         includes="**/*.java"
         excludes="**/*Client.java"
      />
  </target>

  <target name="compile-client" depends="wscompile-client,init"
      description="Compiles the client-side source code"  >
      <echo message="Compiling the client source code...."/>
      <javac
         srcdir="."
         destdir="${build}/client"
         classpath="${build.classpath}:build/shared:build/client"
         includes="**/*Client.java"
      />
  </target>

  <target name="create-client-jar" depends="compile-client"
      description="Builds the JAR file that contains the client">
      <echo message="Building the client JAR  file...."/>
      <jar jarfile="${assemble}/${clientjar}" >
        <fileset dir="${build}/client" />
        <fileset dir="${build}/shared" > 
             <exclude name="**/*Impl*" />
        </fileset>
      </jar>
     <move file="${assemble}/${clientjar}" todir="../" />
  </target>

  <target name="create-war" depends="compile-server"
     description="Packages the WAR file">
     <echo message="Creating the WAR...."/>
     <delete file="../${portable-war}" />
     <delete dir="${assemble}/WEB-INF" />
     <copy todir="${assemble}/WEB-INF/classes/">
         <fileset dir="${build}/shared/" includes="**/*.class" />
     </copy>
     <copy file="web.xml" todir="${assemble}/WEB-INF" />
     <copy file="jaxrpc-ri.xml" todir="${assemble}/WEB-INF" />
     <jar jarfile="${assemble}/${portable-war}" >
       <fileset dir="${assemble}" includes="WEB-INF/**" />
     </jar>
     <move file="${assemble}/${portable-war}" todir="../" />
  </target>

  <target name="process-war" depends="create-war"
      description="Runs wsdeploy to generate the ties and create a deployable WAR file">
      <echo message="Running wsdeploy...."/>
      <delete file="../${war}" />
      <delete dir="../tmp" />
      <mkdir dir="../tmp" />
      <java classname="com.sun.xml.rpc.tools.wsdeploy.Main" fork="yes" dir=".">
      <classpath path="${build.classpath}"/>
        <arg line="-o"/>
        <arg line="../${war}"/>
        <arg line="-tmpdir"/>
        <arg line="../tmp"/>
        <arg line="../${portable-war}"/>
      </java>
      <delete dir="../tmp" />
  </target>

  <target name="run" depends="init"
     description="Runs the example client">
     <echo message="Running the ${client.class} program:" />
      <java 
            fork="on" 
            classpath="../${clientjar}:${build.classpath}" 
            classname="${client.class}" >
      </java>
  </target>

  <target name="build-static" depends="create-client-jar"
     description="Executes the targets needed to build a static client.">
  </target>

  <target name="build-service" depends="process-war"
     description="Executes the targets needed to build and package the service.">
  </target>

  <target name="core" depends="build-service, build-static"
     description="Executes the targets needed to build this example.">
  </target>

  <target name="init" depends="init_common"/>
  <target name="clean" depends="clean_common"/>
  <target name="deploy" depends="deploy_common"/>
  <target name="undeploy" depends="undeploy_common"/>
  <target name="javadocs" depends="javadocs_common"/>
  <target name="verify" depends="verify_common"/>
  <target name="all" depends="core,javadocs,verify,deploy"/>

</project>
